<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="io.renren.modules.rffss.dao.ThirdColdStorageInfoDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="io.renren.modules.rffss.entity.ThirdColdStorageInfoEntity" id="thirdColdStorageInfoMap">
        <result property="thirdcoldstorageinfoid" column="ThirdColdStorageInfoId"/>
        <result property="applytime" column="APPLYTIME"/>
        <result property="applyname" column="APPLYNAME"/>
        <result property="applycontactinfo" column="APPLYCONTACTINFO"/>
        <result property="proxyname" column="PROXYNAME"/>
        <result property="proxycontactinfo" column="PROXYCONTACTINFO"/>
        <result property="uniscid" column="UNISCID"/>
        <result property="storageentname" column="STORAGEENTNAME"/>
        <result property="lerep" column="LEREP"/>
        <result property="contractname" column="CONTRACTNAME"/>
        <result property="contracttel" column="CONTRACTTEL"/>
        <result property="storagename" column="STORAGENAME"/>
        <result property="storageprovince" column="STORAGEPROVINCE"/>
        <result property="storageprovname" column="STORAGEPROVNAME"/>
        <result property="storagecity" column="STORAGECITY"/>
        <result property="storagecityname" column="STORAGECITYNAME"/>
        <result property="storagecounty" column="STORAGECOUNTY"/>
        <result property="storagecountyname" column="STORAGECOUNTYNAME"/>
        <result property="storageaddress" column="STORAGEADDRESS"/>
        <result property="storagepowerton" column="STORAGEPOWERTON"/>
        <result property="storagepowercubicmeter" column="STORAGEPOWERCUBICMETER"/>
        <result property="recnum" column="RECNUM"/>
        <result property="rectime" column="RECTIME"/>
        <result property="handleunitcode" column="HANDLEUNITCODE"/>
        <result property="handleunit" column="HANDLEUNIT"/>
        <result property="receiver" column="RECEIVER"/>
        <result property="entrytime" column="ENTRYTIME"/>
    </resultMap>

    <select id="selectUnb" resultType="Map">
        select p.id, p.createtime, p.apply_name, p.apply_contact_info, p.storage_ent_name, p.le_rep,
               p.contract_name, p.contract_tel, p.storage_name, p.storage_province,
               (select name from code_addiv where code=p.storage_province) as storage_prov_name,
               p.storage_city,
               (select name from code_addiv where code=p.storage_city) as storage_city_name
                , p.storage_county,
               (select name from code_addiv where code=p.storage_county) as storage_county_name,
               p.storage_address, p.storage_power_ton, p.storage_power_cubic_meter
                , p.unisc_id, p.rec_num, p.rec_time, p.entry_time, p.issueorg,
               (select name from code_organ where code=p.issueorg) as handleunit,
               (select name from nf_agent where businid=(select id from nf_busin where rffsspid=p.id) and name is not null order by createtime desc limit 0, 1) as proxyname,
               (select mobile from nf_agent where businid=(select id from nf_busin where rffsspid=p.id) and mobile is not null order by createtime desc limit 0, 1) as proxycontactinfo,
               (select name from nf_checked where businid=(select id from nf_busin where rffsspid=p.id) and ctype=1 and name is not null order by createtime desc limit 0, 1) as receiver
        from nf_rffssp p left join nf_busin b on p.id=b.rffsspid
        WHERE b.status = 22 and b.btype in ( 10 , 11 , 12 , 20 , 21 , 22 )
          and p.issueorg like '23%'
    </select>
</mapper>
